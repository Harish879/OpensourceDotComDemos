<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Static Web Apps - Authentication</title>
</head>

<body>
    <h1>Static Web Apps - Authentication</h1>
    <div id="loginButtons"></div>
    <div id="userInfo">

    </div>
    <code id="userDetails">

    </code>
    <div id="apiResult">
    </div>
    <p id="data"></p>
    <script>
        const providers = ["github", "twitter", "facebook", "aad"];
        const loginButtons = document.getElementById("loginButtons");
        providers.forEach(provider => {
            const button = document.createElement("button");
            button.innerText = `Login with ${provider}`;
            button.onclick = () => {
                window.location.href = `/.auth/login/${provider}`;
            };
            loginButtons.appendChild(button);
        });

        const userInfo = document.getElementById("userInfo");
        const userDetails = document.getElementById("userDetails");
        fetch("/.auth/me")
            .then(response => response.json())
            .then(data => {
                if (data.clientPrincipal) {
                    const pattern = /@gmail.com/;
                   if (pattern.test(`${data.clientPrincipal.userDetails}`)){
                    window.location.href = `/main.html`;
                   }
                   else{
                    userInfo.innerText = "You are not authorized"
                    window.location.href = `/index.html`;
                   }
                } else {
                    userInfo.innerText = "Hello anonymous";
                }
            });
    </script>
</body>

</html>